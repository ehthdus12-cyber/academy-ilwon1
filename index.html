<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>강남일원독서실 아카데미</title>
    <!-- 라이브러리 로드: 원본 디자인과 기능을 위해 필수 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        
        /* 사용자가 요청한 원본 폰트 스타일 */
        @font-face {
            font-family: 'SeoulNamsanL';
            src: url('https://cdn.jsdelivr.net/gh/seoulcity/seoulfonts@1.0/SeoulNamsanL.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body { 
            font-family: 'SeoulNamsanL', 'Noto Sans KR', sans-serif; 
            background-color: #f8fafc; 
            letter-spacing: -0.02em;
        }
        
        .font-bold-title {
            font-weight: 900;
            letter-spacing: -0.04em;
        }

        .input-focus:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
        }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen pb-20 font-medium">

    <!-- 헤더 (원본 디자인) -->
    <header class="bg-white border-b border-gray-100 sticky top-0 z-30 shadow-sm">
        <div class="max-w-xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold-title text-blue-600 cursor-pointer" onclick="location.reload()">강남일원독서실</h1>
            <div class="flex gap-2">
                <button onclick="setView('search')" class="text-xs font-bold text-gray-600 bg-gray-50 px-3 py-2 rounded-xl border">조회</button>
                <button onclick="handleAdminAuth()" class="text-xs font-bold bg-blue-600 text-white px-3 py-2 rounded-xl shadow-sm">관리</button>
            </div>
        </div>
    </header>

    <main class="max-w-xl mx-auto px-4 mt-8">
        
        <!-- 신청 폼 (원본 디자인 및 로직) -->
        <section id="view-form" class="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
            <div class="bg-blue-600 p-8 text-white text-center">
                <p class="text-sm opacity-90 mb-1 font-medium italic">지식과 꿈이 자라는 공간! 강남일원독서실</p>
                <h2 class="text-2xl font-bold-title tracking-tight">청소년 / 성인아카데미 수강신청</h2>
            </div>
            
            <form onsubmit="handleFormSubmit(event)" class="p-8 space-y-6">
                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 ml-1">수강생명</label>
                    <input type="text" id="reg-name" required placeholder="이름 입력" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl input-focus font-medium">
                </div>

                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 ml-1">연락처</label>
                    <input type="tel" id="reg-phone" required placeholder="010-0000-0000" oninput="onPhoneInput(this.value)" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl input-focus font-mono">
                    <div id="existing-badge"></div>
                </div>

                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 ml-1">생년월일</label>
                    <input type="text" id="reg-birth" required placeholder="1990-01-01" oninput="onBirthInput(this.value)" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl input-focus font-mono">
                </div>

                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 ml-1">과목 선택</label>
                    <select id="reg-course" required onchange="calculatePrice()" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl input-focus appearance-none font-bold">
                        <option value="">생년월일을 먼저 입력하세요</option>
                    </select>
                </div>

                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 ml-1">감면 혜택</label>
                    <select id="reg-discount" onchange="calculatePrice()" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl input-focus appearance-none">
                        <option value="0">해당없음</option>
                        <option value="0.3">30% 감면 (다자녀 청소년/다강좌)</option>
                        <option value="0.5">50% 감면 (수급자/장애인/유공자)</option>
                    </select>
                </div>

                <div class="bg-blue-50 rounded-2xl p-5 flex justify-between items-center border border-blue-100">
                    <span class="text-xs font-bold text-blue-800">최종 납부 금액</span>
                    <span id="display-price" class="text-2xl font-black text-blue-600">0원</span>
                </div>

                <div class="flex items-center gap-2 p-1">
                    <input type="checkbox" id="agree" required class="w-4 h-4 rounded text-blue-600">
                    <label for="agree" class="text-[11px] text-gray-500 font-medium">[필수] 개인정보 수집 및 이용 동의</label>
                </div>

                <button type="submit" class="w-full py-5 bg-blue-600 text-white font-black rounded-2xl shadow-lg active:scale-95 text-xl">
                    수강 신청하기
                </button>
            </form>
        </section>

        <!-- 관리자 뷰 (원본 디자인 및 탭 기능) -->
        <section id="view-admin" class="hidden space-y-6">
            <div class="bg-white rounded-3xl border shadow-sm p-3 flex gap-2 font-bold">
                <button onclick="setAdminTab('apps')" id="btn-apps" class="flex-1 py-3 rounded-2xl transition-all bg-blue-600 text-white shadow-lg">접수내역</button>
                <button onclick="setAdminTab('students')" id="btn-students" class="flex-1 py-3 rounded-2xl transition-all bg-gray-50 text-gray-500">학생관리</button>
                <button onclick="setAdminTab('settings')" id="btn-settings" class="flex-1 py-3 rounded-2xl transition-all bg-gray-50 text-gray-500">기간설정</button>
            </div>

            <div id="admin-apps" class="space-y-4">
                <div class="bg-white p-6 rounded-3xl border shadow-sm space-y-4 font-bold flex flex-col md:flex-row gap-4">
                    <input type="text" id="admin-search" oninput="renderAppList()" placeholder="이름 검색" class="flex-1 p-3 bg-gray-50 border rounded-xl outline-none text-sm">
                    <button onclick="exportToCSV()" class="px-4 py-3 bg-green-50 text-green-700 rounded-xl text-xs font-bold border border-green-100">엑셀 다운로드</button>
                </div>
                <div id="app-list-container" class="space-y-4"></div>
            </div>

            <div id="admin-students" class="hidden">
                <div class="bg-white border rounded-[2rem] p-8 shadow-sm font-bold">
                    <h3 class="font-bold text-gray-700 mb-5">기존 수강생 등록</h3>
                    <div class="flex gap-2 mb-6">
                        <input type="tel" id="new-std-phone" placeholder="010-0000-0000" class="flex-1 p-4 bg-gray-50 border rounded-2xl outline-none font-mono">
                        <button onclick="addExistingStudent()" class="px-6 bg-blue-600 text-white rounded-2xl font-bold">등록</button>
                    </div>
                    <div id="std-list-container" class="space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar"></div>
                </div>
            </div>

            <div id="admin-settings" class="hidden">
                <div class="bg-white border rounded-[2rem] p-8 shadow-sm font-bold space-y-6">
                    <h3 class="font-bold text-gray-700">운영 시즌 설정</h3>
                    <input type="text" id="set-month" value="2026년 03월" class="w-full p-4 bg-gray-50 border rounded-2xl font-bold">
                    <button onclick="alert('설정 저장 완료')" class="w-full py-5 bg-blue-600 text-white rounded-3xl font-black">저장 및 활성화</button>
                </div>
            </div>
        </section>

        <!-- 성공 뷰 (원본 디자인) -->
        <section id="view-success" class="hidden bg-white rounded-[3rem] shadow-2xl p-10 text-center space-y-10 border border-gray-100">
            <div class="w-24 h-24 bg-green-50 text-green-600 rounded-[2rem] flex items-center justify-center mx-auto">
                <i data-lucide="check-circle" class="w-14 h-14"></i>
            </div>
            <div>
                <h2 class="text-3xl font-bold-title text-gray-800 italic" id="success-msg">신청 접수 완료</h2>
                <p class="text-gray-500 mt-2 font-medium" id="success-month">신청이 성공적으로 완료되었습니다.</p>
            </div>
            <div class="bg-gray-50 rounded-[2.5rem] p-10 text-left space-y-6 font-bold border border-gray-100">
                <div class="space-y-4">
                     <div class="flex justify-between items-center text-sm"><span>성함</span><span class="text-lg" id="res-name"></span></div>
                     <div class="flex justify-between items-start text-sm"><span>신청 강좌</span><span class="text-blue-600 text-right font-black" id="res-course"></span></div>
                     <div class="flex justify-between border-t pt-5 border-gray-200"><span>총 수강료</span><span class="text-2xl font-black" id="res-price"></span></div>
                </div>
                <div id="payment-box" class="bg-blue-600 p-8 rounded-[2rem] shadow-xl text-white mt-6">
                    <p class="text-[10px] opacity-70 mb-1 uppercase">Account Info</p>
                    <p class="text-base font-bold mb-5 font-mono">우리은행 1005-204-639684<br>(예금주: 강남일원독서실)</p>
                    <p id="res-depositor" class="text-2xl font-black"></p>
                </div>
            </div>
            <button onclick="location.reload()" class="w-full py-5 bg-gray-100 text-gray-600 font-bold-title rounded-3xl">홈으로 돌아가기</button>
        </section>

    </main>

    <script>
        // --- 원본 데이터 로직 ---
        const courseData = [
            { id: 'ad_1', name: 'AI스마트폰활용', price: 40000, type: 'adult', capacity: 15 },
            { id: 'ad_2', name: '연필풍경스케치', price: 40000, type: 'adult', capacity: 15 },
            { id: 'ad_3', name: '보타니컬아트', price: 40000, type: 'adult', capacity: 15 },
            { id: 'yt_1', name: '창의미술 (초등 1~3학년)', price: 30000, type: 'youth', capacity: 12 },
            { id: 'yt_2', name: '창의논술 A (초등 1~2학년)', price: 30000, type: 'youth', capacity: 12 },
            { id: 'yt_3', name: '이야기한국사 (초5~중2)', price: 30000, type: 'youth', capacity: 15 },
            { id: 'yt_4', name: '중급리딩 (초등 1~6학년)', price: 50000, type: 'youth', capacity: 15 }
        ];

        let applications = JSON.parse(localStorage.getItem('gangnam_apps') || '[]');
        let existingPhones = JSON.parse(localStorage.getItem('gangnam_students') || '["010-1234-5678", "010-8740-5400"]');
        let targetMonth = "2026년 03월";

        // --- 뷰 전환 ---
        function setView(viewId) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-' + viewId).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- 신청 로직 ---
        function onPhoneInput(val) {
            const badge = document.getElementById('existing-badge');
            if (existingPhones.includes(val)) {
                badge.innerHTML = '<p class="text-[10px] font-bold px-2 py-1 rounded-lg bg-green-100 text-green-700 inline-block mt-1">✓ 기존 수강생(우선접수 대상)</p>';
            } else if(val.length >= 11) {
                badge.innerHTML = '<p class="text-[10px] font-bold px-2 py-1 rounded-lg bg-blue-100 text-blue-700 inline-block mt-1">신규 수강생</p>';
            } else { badge.innerHTML = ''; }
        }

        function onBirthInput(val) {
            const year = parseInt(val.split('-')[0]);
            if (!year) return;
            const type = year <= 2007 ? 'adult' : 'youth';
            const select = document.getElementById('reg-course');
            let options = '<option value="">강좌를 선택하세요</option>';
            courseData.filter(c => c.type === type).forEach(c => {
                const count = applications.filter(a => a.courseId === c.id).length;
                const isFull = count >= c.capacity;
                options += `<option value="${c.id}" data-price="${c.price}">${c.name} ${isFull ? '(대기)' : `(${count}/${c.capacity}명)`}</option>`;
            });
            select.innerHTML = options;
        }

        function calculatePrice() {
            const select = document.getElementById('reg-course');
            const base = parseInt(select.options[select.selectedIndex]?.dataset.price || 0);
            const disc = parseFloat(document.getElementById('reg-discount').value);
            document.getElementById('display-price').innerText = (base * (1 - disc)).toLocaleString() + '원';
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const select = document.getElementById('reg-course');
            const cId = select.value;
            const course = courseData.find(c => c.id === cId);
            const count = applications.filter(a => a.courseId === cId).length;
            const status = count >= course.capacity ? 'waiting_list' : 'waiting';

            const app = {
                id: Date.now(),
                name: document.getElementById('reg-name').value,
                phone: document.getElementById('reg-phone').value,
                courseId: cId,
                courseName: course.name,
                price: document.getElementById('display-price').innerText,
                status: status,
                date: new Date().toISOString()
            };

            applications.push(app);
            localStorage.setItem('gangnam_apps', JSON.stringify(applications));
            
            // 성공 화면 노출
            setView('success');
            document.getElementById('res-name').innerText = app.name;
            document.getElementById('res-course').innerText = app.courseName;
            document.getElementById('res-price').innerText = app.price;
            document.getElementById('res-depositor').innerText = app.name + app.courseName.substring(0,4);
            document.getElementById('success-msg').innerText = status === 'waiting_list' ? '대기 접수 완료' : '신청 접수 완료';
            
            lucide.createIcons();
        }

        // --- 관리자 로직 ---
        function handleAdminAuth() {
            if (prompt("관리자 암호를 입력하세요.") === "874054") {
                setView('admin');
                setAdminTab('apps');
            } else { alert("비밀번호 오류"); }
        }

        function setAdminTab(tab) {
            document.getElementById('admin-apps').classList.add('hidden');
            document.getElementById('admin-students').classList.add('hidden');
            document.getElementById('admin-settings').classList.add('hidden');
            document.getElementById('admin-' + tab).classList.remove('hidden');

            document.querySelectorAll('#view-admin button').forEach(b => {
                b.classList.replace('bg-blue-600', 'bg-gray-50');
                b.classList.replace('text-white', 'text-gray-500');
            });
            const btn = document.getElementById('btn-' + tab);
            btn.classList.replace('bg-gray-50', 'bg-blue-600');
            btn.classList.replace('text-gray-500', 'text-white');

            if(tab === 'apps') renderAppList();
            if(tab === 'students') renderStudentList();
        }

        function renderAppList() {
            const search = document.getElementById('admin-search').value.toLowerCase();
            const container = document.getElementById('app-list-container');
            const filtered = applications.filter(a => a.name.toLowerCase().includes(search));
            
            container.innerHTML = filtered.map(a => `
                <div class="bg-white border p-6 rounded-3xl relative shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-xl">${a.name} <span class="text-xs text-gray-400 font-mono">${a.phone}</span></h3>
                            <p class="text-sm font-black text-blue-600 mt-1">${a.courseName}</p>
                        </div>
                        <span class="text-[10px] font-black px-3 py-1 rounded-full ${a.status === 'waiting_list' ? 'bg-orange-500 text-white' : 'bg-yellow-400 text-gray-800'}">${a.status.toUpperCase()}</span>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="deleteApp(${a.id})" class="flex-1 py-2 bg-gray-100 text-gray-400 rounded-xl text-xs font-bold">삭제</button>
                    </div>
                </div>
            `).reverse().join('');
        }

        function deleteApp(id) {
            if(!confirm('정말 삭제할까요?')) return;
            applications = applications.filter(a => a.id !== id);
            localStorage.setItem('gangnam_apps', JSON.stringify(applications));
            renderAppList();
        }

        function renderStudentList() {
            const container = document.getElementById('std-list-container');
            container.innerHTML = existingPhones.map(p => `
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl border">
                    <span class="font-mono text-sm">${p}</span>
                    <button onclick="removeStudent('${p}')" class="text-red-400 text-xs">삭제</button>
                </div>
            `).reverse().join('');
        }

        function addExistingStudent() {
            const p = document.getElementById('new-std-phone').value;
            if(!p) return;
            existingPhones.push(p);
            localStorage.setItem('gangnam_students', JSON.stringify(existingPhones));
            document.getElementById('new-std-phone').value = '';
            renderStudentList();
        }

        function removeStudent(p) {
            existingPhones = existingPhones.filter(item => item !== p);
            localStorage.setItem('gangnam_students', JSON.stringify(existingPhones));
            renderStudentList();
        }

        function exportToCSV() {
            const headers = ["성함", "연락처", "강좌", "금액", "상태", "신청일"];
            const rows = applications.map(a => [a.name, a.phone, a.courseName, a.price, a.status, a.date]);
            let csv = "\uFEFF" + headers.join(",") + "\n";
            rows.forEach(r => csv += r.join(",") + "\n");
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `강남일원_신청명단_${new Date().toLocaleDateString()}.csv`;
            link.click();
        }

        window.onload = () => { lucide.createIcons(); };
    </script>
</body>
</html>

